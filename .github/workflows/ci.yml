name: CI

on:
    push:
        branches:
            - "master"
            - "develop"
    pull_request:
        types: [ready_for_review, synchronize, opened]

jobs:
    conflicts:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout code
              uses: actions/checkout@v2
              with:
                  ref: ${{ github.head_ref }}
            - name: Merge Conflict finder
              uses: olivernybroe/action-conflict-finder@v1.1
    sdk:
        needs: [conflicts]
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node-version: [16.x]
        concurrency:
            group: ${{ github.head_ref }}-sdk
            cancel-in-progress: true
        steps:
            - uses: actions/checkout@v2
            - name: Use Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ matrix.node-version }}
            - name: Cache pnpm modules
              uses: actions/cache@v2
              env:
                  cache-name: cache-pnpm-modules
              with:
                  path: ~/.pnpm-store
                  key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-${{ hashFiles('**/package.json') }}
                  restore-keys: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-
            - name: Install pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: 6.20.4
            - name: Install rimraf
              run: pnpm install rimraf -g
            - name: Install dependencies
              run: node common/scripts/install-run-rush.js install
            - uses: nick-invision/retry@v2
              name: Build
              with:
                  timeout_seconds: 300
                  max_attempts: 3
                  command: node common/scripts/install-run-rush.js build --verbose
            - name: Test
              run: cd packages/sdk/ && pnpm run test -- --coverage
    ada:
        needs: [conflicts]
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node-version: [16.x]
        concurrency:
            group: ${{ github.head_ref }}-ada
            cancel-in-progress: true
        steps:
            - uses: actions/checkout@v2
            - name: Use Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ matrix.node-version }}
            - name: Cache pnpm modules
              uses: actions/cache@v2
              env:
                  cache-name: cache-pnpm-modules
              with:
                  path: ~/.pnpm-store
                  key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-${{ hashFiles('**/package.json') }}
                  restore-keys: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-
            - name: Install pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: 6.20.4
            - name: Install rimraf
              run: pnpm install rimraf -g
            - name: Install dependencies
              run: node common/scripts/install-run-rush.js install
            - uses: nick-invision/retry@v2
              name: Build
              with:
                  timeout_seconds: 300
                  max_attempts: 3
                  command: node common/scripts/install-run-rush.js build --verbose
            - name: Test
              run: cd packages/ada/ && pnpm run test -- --coverage
    ark:
        needs: [conflicts]
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node-version: [16.x]
        concurrency:
            group: ${{ github.head_ref }}-ark
            cancel-in-progress: true
        steps:
            - uses: actions/checkout@v2
            - name: Use Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ matrix.node-version }}
            - name: Cache pnpm modules
              uses: actions/cache@v2
              env:
                  cache-name: cache-pnpm-modules
              with:
                  path: ~/.pnpm-store
                  key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-${{ hashFiles('**/package.json') }}
                  restore-keys: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-
            - name: Install pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: 6.20.4
            - name: Install rimraf
              run: pnpm install rimraf -g
            - name: Install dependencies
              run: node common/scripts/install-run-rush.js install
            - uses: nick-invision/retry@v2
              name: Build
              with:
                  timeout_seconds: 300
                  max_attempts: 3
                  command: node common/scripts/install-run-rush.js build --verbose
            - name: Test
              run: cd packages/ark/ && pnpm run test -- --coverage
    atom:
        needs: [conflicts]
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node-version: [16.x]
        concurrency:
            group: ${{ github.head_ref }}-atom
            cancel-in-progress: true
        steps:
            - uses: actions/checkout@v2
            - name: Use Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ matrix.node-version }}
            - name: Cache pnpm modules
              uses: actions/cache@v2
              env:
                  cache-name: cache-pnpm-modules
              with:
                  path: ~/.pnpm-store
                  key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-${{ hashFiles('**/package.json') }}
                  restore-keys: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-
            - name: Install pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: 6.20.4
            - name: Install rimraf
              run: pnpm install rimraf -g
            - name: Install dependencies
              run: node common/scripts/install-run-rush.js install
            - uses: nick-invision/retry@v2
              name: Build
              with:
                  timeout_seconds: 300
                  max_attempts: 3
                  command: node common/scripts/install-run-rush.js build --verbose
            - name: Test
              run: cd packages/atom/ && pnpm run test -- --coverage
    avax:
        needs: [conflicts]
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node-version: [16.x]
        concurrency:
            group: ${{ github.head_ref }}-avax
            cancel-in-progress: true
        steps:
            - uses: actions/checkout@v2
            - name: Use Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ matrix.node-version }}
            - name: Cache pnpm modules
              uses: actions/cache@v2
              env:
                  cache-name: cache-pnpm-modules
              with:
                  path: ~/.pnpm-store
                  key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-${{ hashFiles('**/package.json') }}
                  restore-keys: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-
            - name: Install pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: 6.20.4
            - name: Install rimraf
              run: pnpm install rimraf -g
            - name: Install dependencies
              run: node common/scripts/install-run-rush.js install
            - uses: nick-invision/retry@v2
              name: Build
              with:
                  timeout_seconds: 300
                  max_attempts: 3
                  command: node common/scripts/install-run-rush.js build --verbose
            - name: Test
              run: cd packages/avax/ && pnpm run test -- --coverage
    btc:
        needs: [conflicts]
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node-version: [16.x]
        concurrency:
            group: ${{ github.head_ref }}-btc
            cancel-in-progress: true
        steps:
            - uses: actions/checkout@v2
            - name: Use Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ matrix.node-version }}
            - name: Cache pnpm modules
              uses: actions/cache@v2
              env:
                  cache-name: cache-pnpm-modules
              with:
                  path: ~/.pnpm-store
                  key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-${{ hashFiles('**/package.json') }}
                  restore-keys: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-
            - name: Install pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: 6.20.4
            - name: Install rimraf
              run: pnpm install rimraf -g
            - name: Install dependencies
              run: node common/scripts/install-run-rush.js install
            - uses: nick-invision/retry@v2
              name: Build
              with:
                  timeout_seconds: 300
                  max_attempts: 3
                  command: node common/scripts/install-run-rush.js build --verbose
            - name: Test
              run: cd packages/btc/ && pnpm run test -- --coverage
    dot:
        needs: [conflicts]
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node-version: [16.x]
        concurrency:
            group: ${{ github.head_ref }}-dot
            cancel-in-progress: true
        steps:
            - uses: actions/checkout@v2
            - name: Use Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ matrix.node-version }}
            - name: Cache pnpm modules
              uses: actions/cache@v2
              env:
                  cache-name: cache-pnpm-modules
              with:
                  path: ~/.pnpm-store
                  key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-${{ hashFiles('**/package.json') }}
                  restore-keys: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-
            - name: Install pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: 6.20.4
            - name: Install rimraf
              run: pnpm install rimraf -g
            - name: Install dependencies
              run: node common/scripts/install-run-rush.js install
            - uses: nick-invision/retry@v2
              name: Build
              with:
                  timeout_seconds: 300
                  max_attempts: 3
                  command: node common/scripts/install-run-rush.js build --verbose
            - name: Test
              run: cd packages/dot/ && pnpm run test -- --coverage --forceExit
    egld:
        needs: [conflicts]
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node-version: [16.x]
        concurrency:
            group: ${{ github.head_ref }}-egld
            cancel-in-progress: true
        steps:
            - uses: actions/checkout@v2
            - name: Use Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ matrix.node-version }}
            - name: Cache pnpm modules
              uses: actions/cache@v2
              env:
                  cache-name: cache-pnpm-modules
              with:
                  path: ~/.pnpm-store
                  key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-${{ hashFiles('**/package.json') }}
                  restore-keys: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-
            - name: Install pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: 6.20.4
            - name: Install rimraf
              run: pnpm install rimraf -g
            - name: Install dependencies
              run: node common/scripts/install-run-rush.js install
            - uses: nick-invision/retry@v2
              name: Build
              with:
                  timeout_seconds: 300
                  max_attempts: 3
                  command: node common/scripts/install-run-rush.js build --verbose
            - name: Test
              run: cd packages/egld/ && pnpm run test -- --coverage
    eos:
        needs: [conflicts]
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node-version: [16.x]
        concurrency:
            group: ${{ github.head_ref }}-eos
            cancel-in-progress: true
        steps:
            - uses: actions/checkout@v2
            - name: Use Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ matrix.node-version }}
            - name: Cache pnpm modules
              uses: actions/cache@v2
              env:
                  cache-name: cache-pnpm-modules
              with:
                  path: ~/.pnpm-store
                  key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-${{ hashFiles('**/package.json') }}
                  restore-keys: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-
            - name: Install pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: 6.20.4
            - name: Install rimraf
              run: pnpm install rimraf -g
            - name: Install dependencies
              run: node common/scripts/install-run-rush.js install
            - uses: nick-invision/retry@v2
              name: Build
              with:
                  timeout_seconds: 300
                  max_attempts: 3
                  command: node common/scripts/install-run-rush.js build --verbose
            - name: Test
              run: cd packages/eos/ && pnpm run test -- --coverage
    eth:
        needs: [conflicts]
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node-version: [16.x]
        concurrency:
            group: ${{ github.head_ref }}-eth
            cancel-in-progress: true
        steps:
            - uses: actions/checkout@v2
            - name: Use Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ matrix.node-version }}
            - name: Cache pnpm modules
              uses: actions/cache@v2
              env:
                  cache-name: cache-pnpm-modules
              with:
                  path: ~/.pnpm-store
                  key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-${{ hashFiles('**/package.json') }}
                  restore-keys: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-
            - name: Install pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: 6.20.4
            - name: Install rimraf
              run: pnpm install rimraf -g
            - name: Install dependencies
              run: node common/scripts/install-run-rush.js install
            - uses: nick-invision/retry@v2
              name: Build
              with:
                  timeout_seconds: 300
                  max_attempts: 3
                  command: node common/scripts/install-run-rush.js build --verbose
            - name: Test
              run: cd packages/eth/ && pnpm run test -- --coverage
    lsk:
        needs: [conflicts]
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node-version: [16.x]
        concurrency:
            group: ${{ github.head_ref }}-lsk
            cancel-in-progress: true
        steps:
            - uses: actions/checkout@v2
            - name: Use Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ matrix.node-version }}
            - name: Cache pnpm modules
              uses: actions/cache@v2
              env:
                  cache-name: cache-pnpm-modules
              with:
                  path: ~/.pnpm-store
                  key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-${{ hashFiles('**/package.json') }}
                  restore-keys: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-
            - name: Install pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: 6.20.4
            - name: Install rimraf
              run: pnpm install rimraf -g
            - name: Install dependencies
              run: node common/scripts/install-run-rush.js install
            - uses: nick-invision/retry@v2
              name: Build
              with:
                  timeout_seconds: 300
                  max_attempts: 3
                  command: node common/scripts/install-run-rush.js build --verbose
            - name: Test
              run: cd packages/lsk/ && pnpm run test -- --coverage
    nano:
        needs: [conflicts]
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node-version: [16.x]
        concurrency:
            group: ${{ github.head_ref }}-nano
            cancel-in-progress: true
        steps:
            - uses: actions/checkout@v2
            - name: Use Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ matrix.node-version }}
            - name: Cache pnpm modules
              uses: actions/cache@v2
              env:
                  cache-name: cache-pnpm-modules
              with:
                  path: ~/.pnpm-store
                  key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-${{ hashFiles('**/package.json') }}
                  restore-keys: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-
            - name: Install pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: 6.20.4
            - name: Install rimraf
              run: pnpm install rimraf -g
            - name: Install dependencies
              run: node common/scripts/install-run-rush.js install
            - uses: nick-invision/retry@v2
              name: Build
              with:
                  timeout_seconds: 300
                  max_attempts: 3
                  command: node common/scripts/install-run-rush.js build --verbose
            - name: Test
              run: cd packages/nano/ && pnpm run test -- --coverage
    neo:
        needs: [conflicts]
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node-version: [16.x]
        concurrency:
            group: ${{ github.head_ref }}-neo
            cancel-in-progress: true
        steps:
            - uses: actions/checkout@v2
            - name: Use Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ matrix.node-version }}
            - name: Cache pnpm modules
              uses: actions/cache@v2
              env:
                  cache-name: cache-pnpm-modules
              with:
                  path: ~/.pnpm-store
                  key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-${{ hashFiles('**/package.json') }}
                  restore-keys: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-
            - name: Install pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: 6.20.4
            - name: Install rimraf
              run: pnpm install rimraf -g
            - name: Install dependencies
              run: node common/scripts/install-run-rush.js install
            - uses: nick-invision/retry@v2
              name: Build
              with:
                  timeout_seconds: 300
                  max_attempts: 3
                  command: node common/scripts/install-run-rush.js build --verbose
            - name: Test
              run: cd packages/neo/ && pnpm run test -- --coverage
    sol:
        needs: [conflicts]
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node-version: [16.x]
        concurrency:
            group: ${{ github.head_ref }}-sol
            cancel-in-progress: true
        steps:
            - uses: actions/checkout@v2
            - name: Use Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ matrix.node-version }}
            - name: Cache pnpm modules
              uses: actions/cache@v2
              env:
                  cache-name: cache-pnpm-modules
              with:
                  path: ~/.pnpm-store
                  key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-${{ hashFiles('**/package.json') }}
                  restore-keys: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-
            - name: Install pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: 6.20.4
            - name: Install rimraf
              run: pnpm install rimraf -g
            - name: Install dependencies
              run: node common/scripts/install-run-rush.js install
            - uses: nick-invision/retry@v2
              name: Build
              with:
                  timeout_seconds: 300
                  max_attempts: 3
                  command: node common/scripts/install-run-rush.js build --verbose
            - name: Test
              run: cd packages/sol/ && pnpm run test -- --coverage
    trx:
        needs: [conflicts]
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node-version: [16.x]
        concurrency:
            group: ${{ github.head_ref }}-trx
            cancel-in-progress: true
        steps:
            - uses: actions/checkout@v2
            - name: Use Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ matrix.node-version }}
            - name: Cache pnpm modules
              uses: actions/cache@v2
              env:
                  cache-name: cache-pnpm-modules
              with:
                  path: ~/.pnpm-store
                  key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-${{ hashFiles('**/package.json') }}
                  restore-keys: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-
            - name: Install pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: 6.20.4
            - name: Install rimraf
              run: pnpm install rimraf -g
            - name: Install dependencies
              run: node common/scripts/install-run-rush.js install
            - uses: nick-invision/retry@v2
              name: Build
              with:
                  timeout_seconds: 300
                  max_attempts: 3
                  command: node common/scripts/install-run-rush.js build --verbose
            - name: Test
              run: cd packages/trx/ && pnpm run test -- --coverage
    xlm:
        needs: [conflicts]
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node-version: [16.x]
        concurrency:
            group: ${{ github.head_ref }}-xlm
            cancel-in-progress: true
        steps:
            - uses: actions/checkout@v2
            - name: Use Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ matrix.node-version }}
            - name: Cache pnpm modules
              uses: actions/cache@v2
              env:
                  cache-name: cache-pnpm-modules
              with:
                  path: ~/.pnpm-store
                  key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-${{ hashFiles('**/package.json') }}
                  restore-keys: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-
            - name: Install pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: 6.20.4
            - name: Install rimraf
              run: pnpm install rimraf -g
            - name: Install dependencies
              run: node common/scripts/install-run-rush.js install
            - uses: nick-invision/retry@v2
              name: Build
              with:
                  timeout_seconds: 300
                  max_attempts: 3
                  command: node common/scripts/install-run-rush.js build --verbose
            - name: Test
              run: cd packages/xlm/ && pnpm run test -- --coverage
    xrp:
        needs: [conflicts]
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node-version: [16.x]
        concurrency:
            group: ${{ github.head_ref }}-xrp
            cancel-in-progress: true
        steps:
            - uses: actions/checkout@v2
            - name: Use Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ matrix.node-version }}
            - name: Cache pnpm modules
              uses: actions/cache@v2
              env:
                  cache-name: cache-pnpm-modules
              with:
                  path: ~/.pnpm-store
                  key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-${{ hashFiles('**/package.json') }}
                  restore-keys: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-
            - name: Install pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: 6.20.4
            - name: Install rimraf
              run: pnpm install rimraf -g
            - name: Install dependencies
              run: node common/scripts/install-run-rush.js install
            - uses: nick-invision/retry@v2
              name: Build
              with:
                  timeout_seconds: 300
                  max_attempts: 3
                  command: node common/scripts/install-run-rush.js build --verbose
            - name: Test
              run: cd packages/xrp/ && pnpm run test -- --coverage
    zil:
        needs: [conflicts]
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node-version: [16.x]
        concurrency:
            group: ${{ github.head_ref }}-zil
            cancel-in-progress: true
        steps:
            - uses: actions/checkout@v2
            - name: Use Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ matrix.node-version }}
            - name: Cache pnpm modules
              uses: actions/cache@v2
              env:
                  cache-name: cache-pnpm-modules
              with:
                  path: ~/.pnpm-store
                  key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-${{ hashFiles('**/package.json') }}
                  restore-keys: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-
            - name: Install pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: 6.20.4
            - name: Install rimraf
              run: pnpm install rimraf -g
            - name: Install dependencies
              run: node common/scripts/install-run-rush.js install
            - uses: nick-invision/retry@v2
              name: Build
              with:
                  timeout_seconds: 300
                  max_attempts: 3
                  command: node common/scripts/install-run-rush.js build --verbose
            - name: Test
              run: cd packages/zil/ && pnpm run test -- --coverage
    cryptography:
        needs: [conflicts]
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node-version: [16.x]
        concurrency:
            group: ${{ github.head_ref }}-cryptography
            cancel-in-progress: true
        steps:
            - uses: actions/checkout@v2
            - name: Use Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ matrix.node-version }}
            - name: Cache pnpm modules
              uses: actions/cache@v2
              env:
                  cache-name: cache-pnpm-modules
              with:
                  path: ~/.pnpm-store
                  key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-${{ hashFiles('**/package.json') }}
                  restore-keys: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-
            - name: Install pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: 6.20.4
            - name: Install rimraf
              run: pnpm install rimraf -g
            - name: Install dependencies
              run: node common/scripts/install-run-rush.js install
            - uses: nick-invision/retry@v2
              name: Build
              with:
                  timeout_seconds: 300
                  max_attempts: 3
                  command: node common/scripts/install-run-rush.js build --verbose
            - name: Test
              run: cd packages/cryptography/ && pnpm run test -- --coverage
    helpers:
        needs: [conflicts]
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node-version: [16.x]
        concurrency:
            group: ${{ github.head_ref }}-helpers
            cancel-in-progress: true
        steps:
            - uses: actions/checkout@v2
            - name: Use Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ matrix.node-version }}
            - name: Cache pnpm modules
              uses: actions/cache@v2
              env:
                  cache-name: cache-pnpm-modules
              with:
                  path: ~/.pnpm-store
                  key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-${{ hashFiles('**/package.json') }}
                  restore-keys: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-
            - name: Install pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: 6.20.4
            - name: Install rimraf
              run: pnpm install rimraf -g
            - name: Install dependencies
              run: node common/scripts/install-run-rush.js install
            - uses: nick-invision/retry@v2
              name: Build
              with:
                  timeout_seconds: 300
                  max_attempts: 3
                  command: node common/scripts/install-run-rush.js build --verbose
            - name: Test
              run: cd packages/helpers/ && pnpm run test -- --coverage
    http-fetch:
        needs: [conflicts]
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node-version: [16.x]
        concurrency:
            group: ${{ github.head_ref }}-http-fetch
            cancel-in-progress: true
        steps:
            - uses: actions/checkout@v2
            - name: Use Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ matrix.node-version }}
            - name: Cache pnpm modules
              uses: actions/cache@v2
              env:
                  cache-name: cache-pnpm-modules
              with:
                  path: ~/.pnpm-store
                  key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-${{ hashFiles('**/package.json') }}
                  restore-keys: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-
            - name: Install pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: 6.20.4
            - name: Install rimraf
              run: pnpm install rimraf -g
            - name: Install dependencies
              run: node common/scripts/install-run-rush.js install
            - uses: nick-invision/retry@v2
              name: Build
              with:
                  timeout_seconds: 300
                  max_attempts: 3
                  command: node common/scripts/install-run-rush.js build --verbose
            - name: Test
              run: cd packages/http-fetch/ && pnpm run test -- --coverage
    intl:
        needs: [conflicts]
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node-version: [16.x]
        concurrency:
            group: ${{ github.head_ref }}-intl
            cancel-in-progress: true
        steps:
            - uses: actions/checkout@v2
            - name: Use Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ matrix.node-version }}
            - name: Cache pnpm modules
              uses: actions/cache@v2
              env:
                  cache-name: cache-pnpm-modules
              with:
                  path: ~/.pnpm-store
                  key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-${{ hashFiles('**/package.json') }}
                  restore-keys: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-
            - name: Install pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: 6.20.4
            - name: Install rimraf
              run: pnpm install rimraf -g
            - name: Install dependencies
              run: node common/scripts/install-run-rush.js install
            - uses: nick-invision/retry@v2
              name: Build
              with:
                  timeout_seconds: 300
                  max_attempts: 3
                  command: node common/scripts/install-run-rush.js build --verbose
            - name: Test
              run: cd packages/intl/ && pnpm run test -- --coverage
    markets:
        needs: [conflicts]
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node-version: [16.x]
        concurrency:
            group: ${{ github.head_ref }}-markets
            cancel-in-progress: true
        steps:
            - uses: actions/checkout@v2
            - name: Use Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ matrix.node-version }}
            - name: Cache pnpm modules
              uses: actions/cache@v2
              env:
                  cache-name: cache-pnpm-modules
              with:
                  path: ~/.pnpm-store
                  key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-${{ hashFiles('**/package.json') }}
                  restore-keys: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-
            - name: Install pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: 6.20.4
            - name: Install rimraf
              run: pnpm install rimraf -g
            - name: Install dependencies
              run: node common/scripts/install-run-rush.js install
            - uses: nick-invision/retry@v2
              name: Build
              with:
                  timeout_seconds: 300
                  max_attempts: 3
                  command: node common/scripts/install-run-rush.js build --verbose
            - name: Test
              run: cd packages/markets/ && pnpm run test -- --coverage
    news:
        needs: [conflicts]
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node-version: [16.x]
        concurrency:
            group: ${{ github.head_ref }}-news
            cancel-in-progress: true
        steps:
            - uses: actions/checkout@v2
            - name: Use Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ matrix.node-version }}
            - name: Cache pnpm modules
              uses: actions/cache@v2
              env:
                  cache-name: cache-pnpm-modules
              with:
                  path: ~/.pnpm-store
                  key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-${{ hashFiles('**/package.json') }}
                  restore-keys: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-
            - name: Install pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: 6.20.4
            - name: Install rimraf
              run: pnpm install rimraf -g
            - name: Install dependencies
              run: node common/scripts/install-run-rush.js install
            - uses: nick-invision/retry@v2
              name: Build
              with:
                  timeout_seconds: 300
                  max_attempts: 3
                  command: node common/scripts/install-run-rush.js build --verbose
            - name: Test
              run: cd packages/news/ && pnpm run test -- --coverage
    profiles:
        needs: [conflicts]
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node-version: [14.x]
        concurrency:
            group: ${{ github.head_ref }}-profiles
            cancel-in-progress: true
        steps:
            - uses: actions/checkout@v2
            - name: Use Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ matrix.node-version }}
            - name: Cache pnpm modules
              uses: actions/cache@v2
              env:
                  cache-name: cache-pnpm-modules
              with:
                  path: ~/.pnpm-store
                  key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-${{ hashFiles('**/package.json') }}
                  restore-keys: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-
            - name: Install pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: 6.20.4
            - name: Install rimraf
              run: pnpm install rimraf -g
            - name: Install dependencies
              run: node common/scripts/install-run-rush.js install
            - uses: nick-invision/retry@v2
              name: Build
              with:
                  timeout_seconds: 300
                  max_attempts: 3
                  command: node common/scripts/install-run-rush.js build --verbose
            - name: Test
              run: cd packages/profiles/ && pnpm run test -- --coverage
    luna:
        needs: [conflicts]
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node-version: [14.x]
        concurrency:
            group: ${{ github.head_ref }}-luna
            cancel-in-progress: true
        steps:
            - uses: actions/checkout@v2
            - name: Use Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v1
              with:
                  node-version: ${{ matrix.node-version }}
            - name: Cache pnpm modules
              uses: actions/cache@v2
              env:
                  cache-name: cache-pnpm-modules
              with:
                  path: ~/.pnpm-store
                  key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-${{ hashFiles('**/package.json') }}
                  restore-keys: ${{ runner.os }}-build-${{ env.cache-name }}-${{ matrix.node-version }}-
            - name: Install pnpm
              uses: pnpm/action-setup@v2
              with:
                  version: 6.20.4
            - name: Install rimraf
              run: pnpm install rimraf -g
            - name: Install dependencies
              run: node common/scripts/install-run-rush.js install
            - uses: nick-invision/retry@v2
              name: Build
              with:
                  timeout_seconds: 300
                  max_attempts: 3
                  command: node common/scripts/install-run-rush.js build --verbose
            - name: Test
              run: cd packages/luna/ && pnpm run test -- --coverage
